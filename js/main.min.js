const _0x327c70=_0x3238;!function(e,o){const t=_0x3238,n=_0x5414();for(;;)try{if(616482===parseInt(t(345))/1*(parseInt(t(257))/2)+parseInt(t(393))/3*(parseInt(t(338))/4)+-parseInt(t(416))/5*(-parseInt(t(381))/6)+-parseInt(t(358))/7+parseInt(t(301))/8*(parseInt(t(379))/9)+parseInt(t(265))/10+-parseInt(t(373))/11)break;n.push(n.shift())}catch(e){n.push(n.shift())}}();import*as _0x4f3329 from"three";import{PointerLockControls}from"three/addons/controls/PointerLockControls.js";import{GLTFLoader}from"three/addons/loaders/GLTFLoader.js";const IK_BASE_URL=_0x327c70(281),params=new URLSearchParams(window.location[_0x327c70(353)]),museumId=params[_0x327c70(313)]("id");if(!museumId){const e=_0x327c70(316),o=encodeURIComponent(_0x327c70(299)),t=_0x327c70(260)+e+"?text="+o;throw document[_0x327c70(258)][_0x327c70(300)]=_0x327c70(340)+t+_0x327c70(292),new Error(_0x327c70(408))}const museumFolderUrl=IK_BASE_URL+"/"+museumId;let photoConfig=[],activeLayout=_0x327c70(375);const loaderOverlay=document[_0x327c70(235)]("loader-overlay"),loaderBarFill=document.getElementById(_0x327c70(272)),loaderPercent=document[_0x327c70(235)](_0x327c70(234)),loadingManager=new(_0x4f3329[_0x327c70(356)]);loadingManager[_0x327c70(342)]=function(e,o,t){const n=_0x327c70;loaderOverlay[n(242)][n(374)]="1",loaderOverlay[n(242)].display="flex",loaderBarFill.style[n(322)]="0%",loaderPercent[n(331)]="0%"},loadingManager.onProgress=function(e,o,t){const n=_0x327c70,a=t?o/t:0,r=Math.round(100*a);loaderBarFill[n(242)].width=r+"%",loaderPercent.textContent=r+"%"},loadingManager[_0x327c70(266)]=function(){const e=_0x327c70;loaderBarFill[e(242)][e(322)]="100%",loaderPercent[e(331)]=e(415),loaderOverlay.style.opacity="0",setTimeout((()=>{const o=e;loaderOverlay[o(242)][o(385)]="none"}),650)};const scene=new(_0x4f3329[_0x327c70(317)]);scene[_0x327c70(378)]=new(_0x4f3329[_0x327c70(323)])(329750),scene[_0x327c70(318)]=new(_0x4f3329[_0x327c70(252)])(329750,20,80);const camera=new _0x4f3329.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);camera[_0x327c70(405)][_0x327c70(294)](0,1.7,0),camera[_0x327c70(414)][_0x327c70(364)]=_0x327c70(277);let yaw=0,pitch=0;const listener=new(_0x4f3329[_0x327c70(365)]);camera.add(listener);const sound=new(_0x4f3329[_0x327c70(271)])(listener);let musicReady=!1,pendingPlay=!1;const audioLoader=new _0x4f3329.AudioLoader(loadingManager);function loadBackgroundMusic(e){const o=_0x327c70,t="music/"+(e||o(369))[o(280)]();audioLoader[o(333)](t,(function(e){const t=o;sound[t(290)](e),sound[t(327)](!0),sound[t(409)](.25),musicReady=!0,pendingPlay&&!sound[t(268)]&&sound[t(403)]()}),void 0,(function(e){console.log("Audio no disponible:",e)}))}document[_0x327c70(289)](_0x327c70(389),(()=>{const e=_0x327c70;!sound[e(268)]&&(musicReady?sound[e(403)]():pendingPlay=!0)}));const renderer=new _0x4f3329.WebGLRenderer({antialias:!0});renderer.setPixelRatio(Math[_0x327c70(251)](window.devicePixelRatio,1)),renderer[_0x327c70(244)](window[_0x327c70(239)],window[_0x327c70(407)]),renderer[_0x327c70(361)][_0x327c70(285)]=!1,document[_0x327c70(258)][_0x327c70(352)](renderer[_0x327c70(349)]);const ambientLight=new(_0x4f3329[_0x327c70(230)])(16774633,1);scene[_0x327c70(240)](ambientLight);const hemiLight=new(_0x4f3329[_0x327c70(350)])(16774633,1776418,.7);scene[_0x327c70(240)](hemiLight);const directionalLight=new _0x4f3329.DirectionalLight(16773341,.5);directionalLight[_0x327c70(405)].set(5,8,5),directionalLight[_0x327c70(264)]=!1,scene[_0x327c70(240)](directionalLight);const roomWidth=18,roomLength=36*.65,baseWallHeight=6,outerWallHeight=1.3*baseWallHeight,texLoader=new(_0x4f3329[_0x327c70(225)])(loadingManager),marbleColor=texLoader[_0x327c70(333)](_0x327c70(337)),marbleAO=texLoader.load(_0x327c70(243)),marbleNormal=texLoader.load("img/texturas/paredes/MARBLE-normal.jpg");function _0x5414(){const e=["then","¬°Hola! Quiero comprar un Museo 3D. ¬øMe das info y precios?","innerHTML","8aeEaXD","pointerId","music","intersectObjects","forEach","applyQuaternion","pointerdown","getBoundingClientRect","error","colorSpace","minX","setXY","get","top","receiveShadow","51970264766","Scene","fog","SpotLight","keydown","warn","width","Color","KeyA","code","cos","setLoop","hypot","sin","array","textContent","aspect","load","computeBoundingBox","Mesh","MathUtils","img/texturas/paredes/MARBLE-diffuse.jpg","412bcOmsq","KeyD",'\n    <div style="\n      min-height:100vh;\n      display:flex;\n      align-items:center;\n      justify-content:center;\n      padding:28px;\n      background: radial-gradient(circle at top, #432371 0%, #1c2541 35%, #050816 100%);\n      font-family: system-ui, -apple-system, Segoe UI, sans-serif;\n      color:#fff;\n    ">\n      <div style="\n        width:min(920px, 100%);\n        border-radius:24px;\n        padding:28px;\n        background: rgba(5, 8, 22, 0.72);\n        border: 1px solid rgba(255,255,255,0.16);\n        box-shadow: 0 20px 60px rgba(0,0,0,0.55);\n        backdrop-filter: blur(10px);\n        position:relative;\n        overflow:hidden;\n      ">\n        <div style="\n          position:absolute;\n          inset:-2px;\n          background: radial-gradient(circle at 20% 20%, rgba(255,122,136,0.18), transparent 45%),\n                      radial-gradient(circle at 80% 10%, rgba(255,213,138,0.14), transparent 40%),\n                      radial-gradient(circle at 70% 80%, rgba(120,88,255,0.12), transparent 45%);\n          pointer-events:none;\n        "></div>\n\n        <div style="position:relative; z-index:1;">\n          <div style="\n            display:inline-flex;\n            align-items:center;\n            gap:10px;\n            padding:8px 12px;\n            border-radius:999px;\n            background: rgba(255,255,255,0.08);\n            border: 1px solid rgba(255,255,255,0.14);\n            font-size:12px;\n            letter-spacing:0.08em;\n            text-transform:uppercase;\n            opacity:0.95;\n          ">\n            üèõÔ∏è Museo 3D\n            <span style="opacity:0.75;">¬∑</span>\n            <span style="opacity:0.9;">Acceso por link</span>\n          </div>\n\n          <h1 style="\n            margin:14px 0 6px;\n            font-size: clamp(26px, 4vw, 40px);\n            line-height:1.1;\n            letter-spacing:-0.02em;\n          ">\n            Este link a√∫n no tiene un museo asignado ‚ú®\n          </h1>\n\n          <p style="\n            margin:0 0 18px;\n            color: rgba(255,255,255,0.84);\n            font-size: clamp(14px, 2vw, 16px);\n            line-height:1.55;\n            max-width: 62ch;\n          ">\n            Para ver tu Museo en 3D necesitas un <b>c√≥digo de museo</b>.\n            Si todav√≠a no tienes uno, puedes <b>comprar tu museo</b> y lo armamos con tus fotos y frases üíõ\n          </p>\n\n          <div style="\n            display:flex;\n            flex-wrap:wrap;\n            gap:12px;\n            margin-top: 14px;\n          ">\n            <a href="',"SRGBColorSpace","onStart","MeshStandardMaterial","captionText","1lyoFZO","scale","Imagen no cargada a√∫n","DirectionalLight","domElement","HemisphereLight","updateMatrixWorld","appendChild","search","No se pudo cargar ","getDelta","LoadingManager","getY","2918041DuyAre","keyup","üèõÔ∏è Layout activo:","shadowMap","Vector3","length","order","AudioListener","KeyS","DoubleSide","setFromCamera","until_i_found_you.mp3","target","layout","json","15880348sNTXVO","opacity","default","attributes","push","background","2168433DwecBT","photos","1200KaLUqk","right","resize","Shape","display","atan2","setScalar","img","click","img/texturas/techo/BIANCO%20LASA%20VENATO%20GOLD%20ZEROCARE%20-%20POLISHED%20-%20MARBLE-diffuse.jpg","addScaledVector","Clock","25107KZhzSQ","setAttribute","render","left","preventDefault","clamp","querySelector","uv2","absellipse","map","play","height","position","userData","innerHeight","Museo sin ID en URL","setVolume","clientY","max","clientX","lineTo","rotation","100%","17495yMMgvJ","pointermove","BufferGeometry","Group","isArray","#info .hint","random","rotate-overlay","TextureLoader","Error cargando config del museo:","none","img/texturas/piso/SLATE-normal.jpg","Usa el joystick para moverte ¬∑ Toca y arrastra la pantalla para mirar alrededor","AmbientLight","log","pointerup","Error cargando ","loader-percent","getElementById","wrapS","wrapT","BoxGeometry","innerWidth","add","material","style","img/texturas/paredes/MARBLE-ao.jpg","setSize","BufferAttribute","needsUpdate","string","ArrowLeft","ArrowRight","scene","min","Fog","img/texturas/piso/SLATE-diffuse.jpg","includes","25px","copy","758126hwBVFd","body","Points","https://wa.me/","image","‚ùå Error cargando marco GLB:","lock","castShadow","2952060IpFXDT","onLoad","repeat","isPlaying","RepeatWrapping","quaternion","Audio","loader-bar-fill","userAgent","getSize","distanceTo","pointercancel","YXZ","joystick","block","trim","https://ik.imagekit.io/y6ivkwjoq","maxX","Este museo no est√° disponible üò¢","setHex","enabled","clone","outer","SphereGeometry","addEventListener","setBuffer","MeshBasicMaterial",'" target="_blank" rel="noopener"\n              style="\n                display:inline-flex;\n                align-items:center;\n                gap:10px;\n                padding:12px 16px;\n                border-radius:14px;\n                color:#101018;\n                font-weight:700;\n                text-decoration:none;\n                background: linear-gradient(90deg, #ff7a88, #ffd58a);\n                box-shadow: 0 10px 26px rgba(0,0,0,0.35);\n              ">\n              üí¨ Comprar por WhatsApp\n              <span style="font-weight:600; opacity:0.75;">(+51 970 264 766)</span>\n            </a>\n\n            <a href="https://www.museo3d.com/?id=Demo"\n              style="\n                display:inline-flex;\n                align-items:center;\n                gap:10px;\n                padding:12px 16px;\n                border-radius:14px;\n                color:#fff;\n                font-weight:650;\n                text-decoration:none;\n                background: rgba(255,255,255,0.08);\n                border: 1px solid rgba(255,255,255,0.18);\n              ">\n              üß™ Ver demo\n            </a>\n          </div>\n\n          <div style="\n            margin-top: 18px;\n            padding:14px 14px;\n            border-radius:16px;\n            background: rgba(0,0,0,0.18);\n            border: 1px solid rgba(255,255,255,0.10);\n            color: rgba(255,255,255,0.82);\n            font-size: 13px;\n            line-height:1.5;\n          ">\n            <b>Tip r√°pido:</b> Si te pasaron un link, aseg√∫rate de que termine as√≠:\n            <span style="display:inline-block; margin-top:6px; padding:6px 10px; border-radius:10px; background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.12);">\n              https://www.museo3d.com/?id=TU_CODIGO\n            </span>\n          </div>\n        </div>\n      </div>\n    </div>\n  ',"PlaneGeometry","set","ArrowDown","modelos/marco.glb","joystick-inner"];return(_0x5414=function(){return e})()}[marbleColor,marbleAO,marbleNormal][_0x327c70(305)]((e=>{const o=_0x327c70;e.wrapS=e.wrapT=_0x4f3329.RepeatWrapping,e[o(267)][o(294)](.8,.6)}));const slateColor=texLoader[_0x327c70(333)](_0x327c70(253)),slateAO=texLoader[_0x327c70(333)]("img/texturas/piso/SLATE-ao.jpg"),slateNormal=texLoader[_0x327c70(333)](_0x327c70(228));[slateColor,slateAO,slateNormal].forEach((e=>{const o=_0x327c70;e.wrapS=e[o(237)]=_0x4f3329[o(269)],e[o(267)][o(294)](1,1.5)}));const amethystColor=texLoader[_0x327c70(333)](_0x327c70(390)),amethystAO=texLoader[_0x327c70(333)]("img/texturas/techo/BIANCO%20LASA%20VENATO%20GOLD%20ZEROCARE%20-%20POLISHED%20-%20MARBLE-ao.jpg"),amethystNormal=texLoader[_0x327c70(333)]("img/texturas/techo/BIANCO%20LASA%20VENATO%20GOLD%20ZEROCARE%20-%20POLISHED%20-%20MARBLE-normal.jpg");[amethystColor,amethystAO,amethystNormal][_0x327c70(305)]((e=>{const o=_0x327c70;e[o(236)]=e[o(237)]=_0x4f3329[o(269)],e.repeat[o(294)](1,1)}));const allFrames=[],wallMaterial=new(_0x4f3329[_0x327c70(343)])({map:marbleColor,aoMap:marbleAO,normalMap:marbleNormal,roughness:.4,metalness:0,side:_0x4f3329[_0x327c70(367)]}),floorMaterial=new(_0x4f3329[_0x327c70(343)])({map:slateColor,normalMap:slateNormal,aoMap:slateAO,roughness:.65,metalness:.05}),ceilingMaterial=new _0x4f3329.MeshStandardMaterial({map:amethystColor,normalMap:amethystNormal,aoMap:amethystAO,roughness:.35,metalness:.1}),outerFrameMaterial=new(_0x4f3329[_0x327c70(343)])({color:5592405,roughness:.6}),matMaterial=new(_0x4f3329[_0x327c70(343)])({color:14933717,roughness:.8}),gltfLoader=new GLTFLoader(loadingManager);let frameModel=null;gltfLoader[_0x327c70(333)](_0x327c70(296),(e=>{const o=_0x327c70;frameModel=e[o(250)];const t=(new _0x4f3329.Box3).setFromObject(frameModel),n=new _0x4f3329.Vector3;t.getSize(n);const a=1/Math[o(411)](n.x,n.y);frameModel.scale[o(387)](a);const r=new(_0x4f3329[o(362)]);t.getCenter(r),frameModel.position.sub(r);for(const e of allFrames){const t=e[o(406)][o(287)];t&&e.remove(t);const n=frameModel[o(286)](!0);n[o(414)].y=Math.PI,e[o(240)](n),e.userData[o(287)]=n,e.userData[o(388)][o(241)][o(402)]?.[o(261)]&&applyTextureToFrame(e,e[o(406)][o(388)][o(241)].map,e[o(406)][o(344)]||"")}console[o(231)]("‚úÖ Marcos GLB inyectados correctamente")}),void 0,(e=>{const o=_0x327c70;console[o(309)](o(262),e)}));const floorGeom=new(_0x4f3329[_0x327c70(293)])(roomWidth,roomLength,64,64);function _0x3238(e,o){e-=219;return _0x5414()[e]}floorGeom[_0x327c70(394)](_0x327c70(400),new _0x4f3329.BufferAttribute(floorGeom.attributes.uv.array,2));const floor=new(_0x4f3329[_0x327c70(335)])(floorGeom,floorMaterial);floor[_0x327c70(414)].x=-Math.PI/2,floor.receiveShadow=!0,scene[_0x327c70(240)](floor);const ceilingThickness=.35,circleRadius=4,ceilingShape=new(_0x4f3329[_0x327c70(384)]);ceilingShape.moveTo(-roomWidth/2,-roomLength/2),ceilingShape.lineTo(roomWidth/2,-roomLength/2),ceilingShape[_0x327c70(413)](roomWidth/2,roomLength/2),ceilingShape[_0x327c70(413)](-roomWidth/2,roomLength/2),ceilingShape[_0x327c70(413)](-roomWidth/2,-roomLength/2);const holePath=new _0x4f3329.Path;holePath[_0x327c70(401)](0,0,4,4,0,2*Math.PI),ceilingShape.holes.push(holePath);const ceilingGeom=new _0x4f3329.ExtrudeGeometry(ceilingShape,{depth:.35,bevelEnabled:!1});ceilingGeom[_0x327c70(334)]();const bbox=ceilingGeom.boundingBox,sizeCeil=new(_0x4f3329[_0x327c70(362)]);bbox[_0x327c70(274)](sizeCeil);const posAttr=ceilingGeom.attributes[_0x327c70(405)],uvAttr=ceilingGeom[_0x327c70(376)].uv,scaleU=.15,scaleV=.15;for(let n=0;n<uvAttr.count;n++){const a=posAttr.getX(n),r=posAttr[_0x327c70(357)](n),i=(a-bbox.min.x)/sizeCeil.x,c=(r-bbox[_0x327c70(251)].y)/sizeCeil.y;uvAttr[_0x327c70(312)](n,.15*i,.15*c)}uvAttr.needsUpdate=!0,ceilingGeom[_0x327c70(394)](_0x327c70(400),new(_0x4f3329[_0x327c70(245)])(ceilingGeom.attributes.uv[_0x327c70(330)],2));const ceilingMesh=new(_0x4f3329[_0x327c70(335)])(ceilingGeom,ceilingMaterial);ceilingMesh[_0x327c70(414)].x=-Math.PI/2,ceilingMesh[_0x327c70(405)].y=outerWallHeight,scene[_0x327c70(240)](ceilingMesh);const skyGeom=new _0x4f3329.SphereGeometry(80,32,32),skyMat=new(_0x4f3329[_0x327c70(291)])({color:329750,side:_0x4f3329.BackSide}),skyDome=new(_0x4f3329[_0x327c70(335)])(skyGeom,skyMat);scene.add(skyDome);const starCount=750,starPositions=new Float32Array(2250);for(let s=0;s<750;s++){const l=60+12*Math[_0x327c70(223)](),d=Math[_0x327c70(223)]()*Math.PI*2,m=Math[_0x327c70(223)]()*Math.PI/2;starPositions[3*s]=l*Math[_0x327c70(326)](d)*Math[_0x327c70(329)](m),starPositions[3*s+1]=l*Math[_0x327c70(326)](m),starPositions[3*s+2]=l*Math.sin(d)*Math[_0x327c70(329)](m)}const starGeom=new(_0x4f3329[_0x327c70(219)]);starGeom.setAttribute(_0x327c70(405),new(_0x4f3329[_0x327c70(245)])(starPositions,3));const starMat=new _0x4f3329.PointsMaterial({color:16777215,size:.4,sizeAttenuation:!0}),stars=new(_0x4f3329[_0x327c70(259)])(starGeom,starMat);scene.add(stars);const moonGeom=new(_0x4f3329[_0x327c70(288)])(2.4,32,32),moonMat=new(_0x4f3329[_0x327c70(291)])({color:16643811}),moon=new(_0x4f3329[_0x327c70(335)])(moonGeom,moonMat);moon[_0x327c70(405)][_0x327c70(294)](-8,50,-10),scene[_0x327c70(240)](moon);const moonLight=new(_0x4f3329[_0x327c70(348)])(16643811,.35);function createWall(e,o,t,n,a,r=0){const i=_0x327c70,c=new(_0x4f3329[i(293)])(e,o,64,64);c[i(394)](i(400),new(_0x4f3329[i(245)])(c[i(376)].uv[i(330)],2));const s=new(_0x4f3329[i(335)])(c,wallMaterial);return s[i(405)][i(294)](t,n,a),s.rotation.y=r,s[i(315)]=!0,scene[i(240)](s),s}moonLight[_0x327c70(405)].copy(moon[_0x327c70(405)]),scene[_0x327c70(240)](moonLight);const frameDepthOffset=.01,basePhotoSize=2.5,matPadding=0,outerPadding=.05,FRAME_WIDTH_FACTOR=.58;function createFrame(){const e=_0x327c70,o=new(_0x4f3329[e(220)]);let t;if(frameModel)t=frameModel[e(286)](!0),t[e(414)].y=Math.PI,o[e(240)](t);else{const n=new(_0x4f3329[e(293)])(1,1);t=new _0x4f3329.Mesh(n,outerFrameMaterial),o[e(240)](t)}const n=new(_0x4f3329[e(293)])(1,1),a=new(_0x4f3329[e(335)])(n,matMaterial);a.position.z=frameDepthOffset,o[e(240)](a);const r=new _0x4f3329.PlaneGeometry(1,1),i=new(_0x4f3329[e(343)])({color:1118481,roughness:.7}),c=new(_0x4f3329[e(335)])(r,i);return c[e(405)].z=2*frameDepthOffset,o[e(240)](c),o[e(406)]={outer:t,mat:a,img:c,caption:null,captionText:""},allFrames.push(o),o}function applyTextureToFrame(e,o,t){const n=_0x327c70,{outer:a,mat:r,img:i}=e[n(406)];if("string"==typeof t&&(e[n(406)].captionText=t),o[n(310)]=_0x4f3329[n(341)],i[n(241)][n(402)]=o,i[n(241)].color[n(284)](16777215),i[n(241)][n(246)]=!0,!o[n(261)])return void console[n(321)](n(347));const c=o[n(261)][n(322)]/o[n(261)].height,s=_0x4f3329[n(336)][n(398)](c,.6,1.6);let l,d;s>=1?(d=basePhotoSize,l=basePhotoSize*s):(l=basePhotoSize,d=basePhotoSize/s);const m=l+matPadding,x=d+matPadding,p=(m+outerPadding)*FRAME_WIDTH_FACTOR,u=x+outerPadding;i[n(346)].set(l,1.02*d,1),r.scale[n(294)](m,x,1),a.scale[n(294)](p,u,1)}function addLightForFrame(e){const o=_0x327c70,t=new(_0x4f3329[o(319)])(16777215,2.2,20,Math.PI/3,.35,1);t[o(264)]=!1;const n=new(_0x4f3329[o(362)])(0,0,1);n[o(306)](e[o(270)]);const a=e.position.clone();a[o(391)](n,-.02),a.y+=1;const r=new _0x4f3329.Object3D;r[o(405)].copy(a),scene[o(240)](r),t[o(405)][o(256)](r.position),t[o(405)][o(391)](n,1),t[o(405)].y+=2,t[o(370)]=r,scene[o(240)](t)}const frameY=3.3,spacingShort=7.5,longWallFrames=3;function addFramesShortWall(e,o){const t=_0x327c70;[-spacingShort/2,spacingShort/2][t(305)]((n=>{const a=t,r=createFrame();r.position[a(294)](n,frameY,e),r.rotation.y=o,scene[a(240)](r),addLightForFrame(r)}))}function addFramesLongWall(e,o){const t=_0x327c70,n=roomLength-10,a=n/(longWallFrames-1);for(let r=0;r<longWallFrames;r++){const i=-n/2+r*a,c=createFrame();c.position.set(e,frameY,i),c[t(414)].y=o,scene[t(240)](c),addLightForFrame(c)}}const collisionBoxes=[],standaloneDepth=.6;function createStandaloneWall(e,o,t,n,a=0){const r=_0x327c70,i=new(_0x4f3329[r(238)])(e,o,standaloneDepth),c=new(_0x4f3329[r(335)])(i,wallMaterial);c[r(405)][r(294)](t,o/2,n),c.rotation.y=a,c[r(315)]=!0,scene[r(240)](c);const s=standaloneDepth/2;return collisionBoxes[r(377)]({minX:t-e/2,maxX:t+e/2,minZ:n-s,maxZ:n+s}),c}function addFrameToWall(e){const o=_0x327c70,t=new(_0x4f3329[o(362)])(0,0,1);t[o(306)](e[o(270)]);const n=standaloneDepth/2+.03,a=createFrame();a.position[o(256)](e.position),a[o(405)].y=frameY,a[o(405)][o(391)](t,n),a.quaternion[o(256)](e[o(270)]),scene.add(a),addLightForFrame(a);const r=createFrame();r.position[o(256)](e[o(405)]),r.position.y=frameY,r[o(405)][o(391)](t,-n),r[o(270)].copy(e[o(270)]),r.rotateY(Math.PI),scene[o(240)](r),addLightForFrame(r)}const centerWallWidth=7;function buildDefaultMuseum(){createWall(roomWidth,outerWallHeight,0,outerWallHeight/2,-roomLength/2,0),createWall(roomWidth,outerWallHeight,0,outerWallHeight/2,roomLength/2,Math.PI),createWall(roomLength,outerWallHeight,-roomWidth/2,outerWallHeight/2,0,Math.PI/2),createWall(roomLength,outerWallHeight,roomWidth/2,outerWallHeight/2,0,-Math.PI/2),addFramesShortWall(-roomLength/2+.05,0),addFramesShortWall(roomLength/2-.05,Math.PI),addFramesLongWall(-roomWidth/2+.05,Math.PI/2),addFramesLongWall(roomWidth/2-.05,-Math.PI/2);addFrameToWall(createStandaloneWall(centerWallWidth,baseWallHeight,0,-6,0));addFrameToWall(createStandaloneWall(centerWallWidth,baseWallHeight,0,6,0))}function buildMuseum(e){const o=_0x327c70;console[o(231)](o(360),e),o(375),buildDefaultMuseum()}function loadConfig(){const e=_0x327c70,o=museumFolderUrl+"/config.json";return fetch(o)[e(298)]((t=>{const n=e;if(!t.ok)throw new Error(n(354)+o);return t[n(372)]()}))[e(298)]((o=>{const t=e;photoConfig=Array[t(221)](o[t(380)])?o[t(380)]:[],activeLayout=o[t(371)]||t(375);loadBackgroundMusic(typeof o[t(303)]===t(247)?o.music:"")})).catch((o=>{const t=e;console[t(309)](t(226),o),alert(t(283))}))}function loadFramePhotos(){const e=_0x327c70,o=Math[e(251)](photoConfig[e(363)],allFrames[e(363)]);for(let t=0;t<o;t++){const{image:o,caption:n}=photoConfig[t],a=allFrames[t],r=n||"";a.userData[e(344)]=r,texLoader.load(o,(e=>{applyTextureToFrame(a,e,r)}),void 0,(t=>{const n=e;console.error(n(233)+o+":",t)}))}}requestAnimationFrame((()=>{const e=_0x327c70;loadConfig()[e(298)]((()=>{buildMuseum(activeLayout),loadFramePhotos()}))}));const controls=new PointerLockControls(camera,renderer[_0x327c70(349)]);document[_0x327c70(289)](_0x327c70(389),(()=>controls[_0x327c70(263)]()));let moveForward=!1,moveBackward=!1,moveLeft=!1,moveRight=!1;document[_0x327c70(289)](_0x327c70(320),(e=>{const o=_0x327c70;"KeyW"!==e[o(325)]&&"ArrowUp"!==e.code||(moveForward=!0),e.code!==o(366)&&e[o(325)]!==o(295)||(moveBackward=!0),e[o(325)]!==o(324)&&e.code!==o(248)||(moveLeft=!0),"KeyD"!==e[o(325)]&&e[o(325)]!==o(249)||(moveRight=!0)})),document[_0x327c70(289)](_0x327c70(359),(e=>{const o=_0x327c70;"KeyW"!==e[o(325)]&&"ArrowUp"!==e[o(325)]||(moveForward=!1),e[o(325)]!==o(366)&&e[o(325)]!==o(295)||(moveBackward=!1),e[o(325)]!==o(324)&&e[o(325)]!==o(248)||(moveLeft=!1),e[o(325)]!==o(339)&&e[o(325)]!==o(249)||(moveRight=!1)}));const isMobile=/Android|iPhone|iPad|iPod/i.test(navigator[_0x327c70(273)]),rotateOverlay=document.getElementById(_0x327c70(224)),joystick=document[_0x327c70(235)](_0x327c70(278)),joystickInner=document[_0x327c70(235)](_0x327c70(297)),hintEl=document[_0x327c70(399)](_0x327c70(222));hintEl.textContent=isMobile?_0x327c70(229):"Haz clic para entrar ¬∑ WASD para moverte ¬∑ Rat√≥n para mirar";let isDraggingView=!1,lastTouchX=0,lastTouchY=0,viewPointerId=null,joystickActive=!1,joyCenterX=0,joyCenterY=0,joystickPointerId=null;if(isMobile){function checkOrientation(){const e=_0x327c70;window[e(407)]>window[e(239)]?(rotateOverlay[e(242)].display="flex",joystick.style.display=e(227)):(rotateOverlay.style[e(385)]=e(227),joystick[e(242)][e(385)]=e(279)),setTimeout(checkOrientation,150)}window[_0x327c70(289)](_0x327c70(383),checkOrientation),checkOrientation(),document[_0x327c70(289)]("pointerdown",(e=>{const o=_0x327c70;if(loaderOverlay&&loaderOverlay[o(242)][o(385)]!==o(227))return;const t=joystick[o(308)]();!(e[o(412)]>=t[o(396)]&&e[o(412)]<=t[o(382)]&&e[o(410)]>=t[o(314)]&&e[o(410)]<=t.bottom)&&null===viewPointerId&&(isDraggingView=!0,viewPointerId=e[o(302)],lastTouchX=e.clientX,lastTouchY=e[o(410)])})),document[_0x327c70(289)](_0x327c70(417),(e=>{const o=_0x327c70;if(!isDraggingView||e[o(302)]!==viewPointerId)return;const t=e[o(412)]-lastTouchX,n=e[o(410)]-lastTouchY;camera[o(414)].y-=.003*t,camera.rotation.z=0,camera[o(414)].x-=.0025*n,camera[o(414)].x=_0x4f3329[o(336)].clamp(camera[o(414)].x,-1.2,1.2),lastTouchX=e[o(412)],lastTouchY=e.clientY})),document[_0x327c70(289)](_0x327c70(232),(e=>{e[_0x327c70(302)]===viewPointerId&&(isDraggingView=!1,viewPointerId=null)})),document[_0x327c70(289)](_0x327c70(276),(e=>{e[_0x327c70(302)]===viewPointerId&&(isDraggingView=!1,viewPointerId=null)})),joystick.addEventListener(_0x327c70(307),(e=>{const o=_0x327c70;if(e[o(397)](),null!==joystickPointerId)return;joystickActive=!0,joystickPointerId=e.pointerId;const t=joystick[o(308)]();joyCenterX=t.left+t[o(322)]/2,joyCenterY=t[o(314)]+t[o(404)]/2,!sound[o(268)]&&(musicReady?sound[o(403)]():pendingPlay=!0)})),document[_0x327c70(289)]("pointermove",(e=>{const o=_0x327c70;if(!joystickActive||e[o(302)]!==joystickPointerId)return;const t=e.clientX-joyCenterX,n=e[o(410)]-joyCenterY,a=Math[o(328)](t,n),r=Math[o(251)](a,30),i=Math[o(386)](n,t),c=Math[o(326)](i)*r,s=Math[o(329)](i)*r;joystickInner[o(242)].left=25+c+"px",joystickInner[o(242)].top=25+s+"px",moveForward=n<-12,moveBackward=n>12,moveRight=t>12,moveLeft=t<-12})),document.addEventListener("pointerup",(e=>{const o=_0x327c70;e[o(302)]===joystickPointerId&&(joystickActive=!1,joystickPointerId=null,joystickInner[o(242)][o(396)]="25px",joystickInner.style.top="25px",moveForward=moveBackward=moveLeft=moveRight=!1)})),document[_0x327c70(289)](_0x327c70(276),(e=>{const o=_0x327c70;e.pointerId===joystickPointerId&&(joystickActive=!1,joystickPointerId=null,joystickInner[o(242)][o(396)]=o(255),joystickInner[o(242)][o(314)]="25px",moveForward=moveBackward=moveLeft=moveRight=!1)}))}const speed=isMobile?3.5:10,clock=new(_0x4f3329[_0x327c70(392)]),wallBoundary=.5,mobileForwardVec=new(_0x4f3329[_0x327c70(362)]),mobileStrafeVec=new _0x4f3329.Vector3,POPUP_DISTANCE=5,raycaster=new _0x4f3329.Raycaster,gazePopup=document[_0x327c70(235)]("gazePopup");function updateGazePopup(){const e=_0x327c70;if(!gazePopup)return;raycaster[e(368)]({x:0,y:0},camera);const o=raycaster[e(304)](allFrames,!0);if(!o.length)return void(gazePopup[e(242)][e(385)]=e(227));let t=o[0].object,n=null;for(;t;){if(allFrames[e(254)](t)){n=t;break}t=t.parent}if(!n)return void(gazePopup[e(242)][e(385)]=e(227));if(camera[e(405)][e(275)](n[e(405)])>POPUP_DISTANCE)return void(gazePopup[e(242)].display=e(227));const a=n[e(406)][e(344)]||"";a.trim()?(gazePopup[e(331)]=a,gazePopup[e(242)][e(385)]=e(279)):gazePopup[e(242)][e(385)]=e(227)}function animate(){const e=_0x327c70;requestAnimationFrame(animate);const o=clock[e(355)]();if(!0===controls.isLocked||isMobile){let t=0,n=0;if(moveForward&&(t+=speed*o),moveBackward&&(t-=speed*o),moveLeft&&(n-=speed*o),moveRight&&(n+=speed*o),0!==t||0!==n){const o=camera.position.x,a=camera[e(405)].z;isMobile?(camera[e(351)](!0),camera.getWorldDirection(mobileForwardVec),mobileForwardVec.y=0,mobileForwardVec.normalize(),mobileStrafeVec[e(294)](-mobileForwardVec.z,0,mobileForwardVec.x),camera[e(405)][e(391)](mobileForwardVec,t),camera[e(405)][e(391)](mobileStrafeVec,n)):(controls.moveForward(t),controls.moveRight(n)),camera[e(405)].x=_0x4f3329[e(336)].clamp(camera[e(405)].x,-roomWidth/2+.5,roomWidth/2-.5),camera[e(405)].z=_0x4f3329[e(336)].clamp(camera[e(405)].z,-roomLength/2+.5,roomLength/2-.5);for(const t of collisionBoxes)if(camera[e(405)].x>t[e(311)]&&camera.position.x<t[e(282)]&&camera.position.z>t.minZ&&camera.position.z<t.maxZ){camera[e(405)].x=o,camera[e(405)].z=a;break}}}updateGazePopup(),renderer[e(395)](scene,camera)}window.addEventListener(_0x327c70(383),(()=>{const e=_0x327c70;camera[e(332)]=window.innerWidth/window[e(407)],camera.updateProjectionMatrix(),renderer[e(244)](window.innerWidth,window[e(407)])})),animate();